(function() {
  var before, error, onSuccess;

  before = function(formData, $form, options) {
    $form.spin();
    $(":input", $form).attr("disabled", true);
    return true;
  };

  onSuccess = function(data, statusText, xhr, $form) {
    var $errorlists;
    $form.spin(false);
    $(":input", $form).attr("disabled", false);
    $("#photo-preview img").attr("src", data.photo);
    $errorlists = $(".errorlist", $form);
    if ($errorlists.length) {
      $errorlists.remove();
    }
  };

  error = function(data, statusText, xhr, $form) {
    var $errorlist, errors, field, message, _i, _len;
    for (field in data.responseJSON) {
      errors = data.responseJSON[field];
      if (errors.length) {
        $errorlist = $("#" + field + "_container .errorlist", $form);
        if (!$errorlist.length) {
          $errorlist = $("<ul>");
          $errorlist.addClass("errorlist");
          $("#" + field + "_container", $form).prepend($errorlist);
        } else {
          $errorlist.html("");
        }
        for (_i = 0, _len = errors.length; _i < _len; _i++) {
          message = errors[_i];
          $errorlist.append($("<li>" + message + "</li>"));
        }
      }
    }
    $form.spin(false);
    $(":input", $form).attr("disabled", false);
  };

  $(function() {
    $("#edit-form").ajaxForm({
      dataType: "json",
      beforeSubmit: before,
      success: onSuccess,
      error: error
    });
  });

}).call(this);

// Generated by CoffeeScript 1.5.0-pre
